import time
try:
    import sim
except:
    print ('--------------------------------------------------------------')
    print ('"sim.py" could not be imported. This means very probably that')
    print ('either "sim.py" or the remoteApi library could not be found.')
    print ('Make sure both are in the same folder as this file,')
    print ('or appropriately adjust the file "sim.py"')
    print ('--------------------------------------------------------------')
    print ('')

sim.simxFinish(-1)
clientID = sim.simxStart('127.0.0.1', 19999, True, True, 5000, 5)

if clientID != -1:
    print('Connected to server')
else:
    print('connection failed')

#get all handles
err, l_motor = sim.simxGetObjectHandle(clientID, "dr20_leftWheel_", sim.simx_opmode_blocking)
err, r_motor = sim.simxGetObjectHandle(clientID, "dr20_rightWheel_", sim.simx_opmode_blocking)
err, us_sensor = sim.simxGetObjectHandle(clientID, "dr20_ultrasonicSensor_", sim.simx_opmode_blocking)

#initialize readings
err, detectionState, detectedPoint, detectedObjectHandle, detectedSurfaceNormalVector = sim.simxReadProximitySensor(clientID, us_sensor, sim.simx_opmode_streaming)
while True:
    err_code, detectionState, detectedPoint, detectedObjectHandle, detectedSurfaceNormalVector = sim.simxReadProximitySensor(clientID, us_sensor, sim.simx_opmode_buffer)
    print("PROXIMITY SENSOR:\n detectionState: {}\n detectedPoint: {}\n detectedObjectHandle: {}".format(detectionState, detectedPoint, detectedObjectHandle))
    time.sleep(0.5)

    #detectionState is the boolean (if there is something in front of it)
    #detectedPoint is the detected point relative to the sensor's location (how far away??)
		#3d array [x,y,z])